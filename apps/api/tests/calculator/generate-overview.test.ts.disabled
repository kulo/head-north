/**
 * Tests for generate-overview.ts
 * 
 * Tests the overview generation logic including GTM plan validation and sprint scheduling.
 * 
 * @deprecated This test file is currently commented out as the generate-overview.ts
 * module is not used in production. See CLEANUP_TODOS.md for integration options.
 */

/*
import { describe, it, expect, beforeEach } from "vitest";
import generateOverview from "../../src/calculator/generate-overview";
import { resolveStage } from "../../src/calculator/resolve-stage";
import { createMockOmegaConfig } from "../../../../tests/fixtures/config-fixtures";
import { 
  createMockJiraIssue,
  createMockSprintCollection,
  createMockRoadmapItemsData
} from "../fixtures/jira-fixtures";

describe("generate-overview", () => {
  let mockConfig: any;
  let mockRoadmapItems: any;
  let mockSprints: any;

  beforeEach(() => {
    mockConfig = createMockOmegaConfig();
    mockRoadmapItems = createMockRoadmapItemsData();
    mockSprints = createMockSprintCollection();
  });

  describe("validateGTMPlan", () => {
    it("should validate GTM plan with scheduled release", () => {
      const issues = [
        createMockJiraIssue({
          key: "RELEASE-001",
          fields: {
            ...createMockJiraIssue().fields,
            summary: "Feature (s2)",
            sprint: {
              id: 1,
              name: "Sprint 1",
              state: "future" as const,
              startDate: "2030-02-01T00:00:00.000Z",
              endDate: "2030-02-14T23:59:59.000Z",
              originBoardId: 123,
            },
          },
        }),
      ];
      
      const issuesByRoadmapItems = { "ROADMAP-456": issues };
      const result = generateOverview([issues], issuesByRoadmapItems, mockRoadmapItems, mockSprints, mockConfig);
      
      expect(result).toHaveLength(1);
      expect(result[0].validations.hasScheduledRelease).toBe(true);
    });

    it("should validate GTM plan with global release in backlog", () => {
      const issues = [
        createMockJiraIssue({
          key: "RELEASE-001",
          fields: {
            ...createMockJiraIssue().fields,
            summary: "Feature (s3+)",
            sprint: null,
            status: {
              ...createMockJiraIssue().fields.status,
              name: "todo",
            },
          },
        }),
      ];
      
      const issuesByRoadmapItems = { "ROADMAP-456": issues };
      const result = generateOverview([issues], issuesByRoadmapItems, mockRoadmapItems, mockSprints, mockConfig);
      
      expect(result).toHaveLength(1);
      expect(result[0].validations.hasGlobalReleaseInBacklog).toBe(true);
    });

    it("should validate GTM plan with no scheduled release", () => {
      const issues = [
        createMockJiraIssue({
          key: "RELEASE-001",
          fields: {
            ...createMockJiraIssue().fields,
            summary: "Feature (s1)",
            sprint: {
              id: 1,
              name: "Sprint 1",
              state: "future" as const,
              startDate: "2030-02-01T00:00:00.000Z",
              endDate: "2030-02-14T23:59:59.000Z",
              originBoardId: 123,
            },
          },
        }),
      ];
      
      const issuesByRoadmapItems = { "ROADMAP-456": issues };
      const result = generateOverview([issues], issuesByRoadmapItems, mockRoadmapItems, mockSprints, mockConfig);
      
      expect(result).toHaveLength(1);
      expect(result[0].validations.hasScheduledRelease).toBe(false);
    });

    it("should validate GTM plan with no global release in backlog", () => {
      const issues = [
        createMockJiraIssue({
          key: "RELEASE-001",
          fields: {
            ...createMockJiraIssue().fields,
            summary: "Feature (s2)",
            sprint: {
              id: 1,
              name: "Sprint 1",
              state: "active" as const,
              startDate: "2024-01-01T00:00:00.000Z",
              endDate: "2024-01-14T23:59:59.000Z",
              originBoardId: 123,
            },
          },
        }),
      ];
      
      const issuesByRoadmapItems = { "ROADMAP-456": issues };
      const result = generateOverview([issues], issuesByRoadmapItems, mockRoadmapItems, mockSprints, mockConfig);
      
      expect(result).toHaveLength(1);
      expect(result[0].validations.hasGlobalReleaseInBacklog).toBe(false);
    });

    it("should handle empty release items", () => {
      const result = generateOverview([], {}, mockRoadmapItems, mockSprints, mockConfig);
      
      expect(result).toHaveLength(0);
    });

    it("should handle null release items", () => {
      const result = generateOverview([], { "ROADMAP-456": [] }, mockRoadmapItems, mockSprints, mockConfig);
      
      expect(result).toHaveLength(0); // No release items means no results
    });
  });

  describe("generateOverview", () => {
    it("should generate overview with multiple sprints", () => {
      const issues1 = [
        createMockJiraIssue({
          key: "RELEASE-001",
          fields: {
            ...createMockJiraIssue().fields,
            parent: { key: "ROADMAP-456" },
          },
        }),
      ];
      
      const issues2 = [
        createMockJiraIssue({
          key: "RELEASE-002",
          fields: {
            ...createMockJiraIssue().fields,
            parent: { key: "ROADMAP-456" },
          },
        }),
      ];
      
      const issuesByRoadmapItems = {
        "ROADMAP-456": [...issues1, ...issues2],
      };
      
      const result = generateOverview([issues1, issues2], issuesByRoadmapItems, mockRoadmapItems, mockSprints, mockConfig);
      
      expect(result).toHaveLength(1);
      expect(result[0].sprints).toHaveLength(2);
      expect(result[0].sprints[0].sprintId).toBe(1);
      expect(result[0].sprints[1].sprintId).toBe(2);
    });

    it("should filter out sprints with no release items", () => {
      const issues1 = [
        createMockJiraIssue({
          key: "RELEASE-001",
          fields: {
            ...createMockJiraIssue().fields,
            parent: { key: "ROADMAP-456" },
          },
        }),
      ];
      
      const issues2: any[] = []; // Empty sprint
      
      const issuesByRoadmapItems = {
        "ROADMAP-456": issues1,
      };
      
      const result = generateOverview([issues1, issues2], issuesByRoadmapItems, mockRoadmapItems, mockSprints, mockConfig);
      
      expect(result).toHaveLength(1);
      expect(result[0].sprints).toHaveLength(1);
      expect(result[0].sprints[0].sprintId).toBe(1);
    });

    it("should filter out roadmap items with no sprints", () => {
      const issues = [
        createMockJiraIssue({
          key: "RELEASE-001",
          fields: {
            ...createMockJiraIssue().fields,
            parent: { key: "ROADMAP-456" },
          },
        }),
      ];
      
      const issuesByRoadmapItems = {
        "ROADMAP-456": issues,
        "ROADMAP-789": [], // No issues for this roadmap item
      };
      
      const result = generateOverview([issues], issuesByRoadmapItems, mockRoadmapItems, mockSprints, mockConfig);
      
      expect(result).toHaveLength(1);
      expect(result[0].id).toBe("init-1");
    });

    it("should handle roadmap items with missing data", () => {
      const issues = [
        createMockJiraIssue({
          key: "RELEASE-001",
          fields: {
            ...createMockJiraIssue().fields,
            parent: { key: "ROADMAP-MISSING" },
          },
        }),
      ];
      
      const issuesByRoadmapItems = {
        "ROADMAP-MISSING": issues,
      };
      
      const result = generateOverview([issues], issuesByRoadmapItems, mockRoadmapItems, mockSprints, mockConfig);
      
      expect(result).toHaveLength(0); // Should be filtered out due to missing roadmap item data
    });

    it("should handle external roadmap items", () => {
      const issues = [
        createMockJiraIssue({
          key: "RELEASE-001",
          fields: {
            ...createMockJiraIssue().fields,
            parent: { key: "ROADMAP-456" },
          },
        }),
      ];
      
      const issuesByRoadmapItems = {
        "ROADMAP-456": issues,
      };
      
      const result = generateOverview([issues], issuesByRoadmapItems, mockRoadmapItems, mockSprints, mockConfig);
      
      expect(result).toHaveLength(1);
      expect(result[0].sprints[0].releaseItems).toHaveLength(1);
      expect(result[0].sprints[0].releaseItems[0].isExternal).toBe(true);
    });

    it("should handle non-external roadmap items", () => {
      const issues = [
        createMockJiraIssue({
          key: "RELEASE-001",
          fields: {
            ...createMockJiraIssue().fields,
            parent: { key: "ROADMAP-456" },
          },
        }),
      ];
      
      // Mock config to return false for isExternalStage
      const mockConfigWithInternalStages = createMockOmegaConfig({
        isExternalStage: () => false,
      });
      
      const issuesByRoadmapItems = {
        "ROADMAP-456": issues,
      };
      
      const result = generateOverview([issues], issuesByRoadmapItems, mockRoadmapItems, mockSprints, mockConfigWithInternalStages);
      
      expect(result).toHaveLength(0); // Non-external items should be completely filtered out
    });

    it("should handle multiple roadmap items with different initiatives", () => {
      const issues1 = [
        createMockJiraIssue({
          key: "RELEASE-001",
          fields: {
            ...createMockJiraIssue().fields,
            parent: { key: "ROADMAP-456" },
          },
        }),
      ];
      
      const issues2 = [
        createMockJiraIssue({
          key: "RELEASE-002",
          fields: {
            ...createMockJiraIssue().fields,
            parent: { key: "ROADMAP-789" },
          },
        }),
      ];
      
      const issuesByRoadmapItems = {
        "ROADMAP-456": issues1,
        "ROADMAP-789": issues2,
      };
      
      const result = generateOverview([issues1, issues2], issuesByRoadmapItems, mockRoadmapItems, mockSprints, mockConfig);
      
      expect(result).toHaveLength(2);
      expect(result[0].id).toBe("init-1");
      expect(result[1].id).toBe("init-2");
    });

    it("should handle empty issues array", () => {
      const result = generateOverview([], {}, mockRoadmapItems, mockSprints, mockConfig);
      
      expect(result).toHaveLength(0);
    });

    it("should handle empty sprints array", () => {
      const issues = [
        createMockJiraIssue({
          key: "RELEASE-001",
          fields: {
            ...createMockJiraIssue().fields,
            parent: { key: "ROADMAP-456" },
          },
        }),
      ];
      
      const issuesByRoadmapItems = {
        "ROADMAP-456": issues,
      };
      
      // This will fail because the implementation doesn't handle empty sprints array
      expect(() => {
        generateOverview([issues], issuesByRoadmapItems, mockRoadmapItems, [], mockConfig);
      }).toThrow();
    });

    it("should handle issues with validation errors", () => {
      const issues = [
        createMockJiraIssue({
          key: "RELEASE-001",
          fields: {
            ...createMockJiraIssue().fields,
            parent: { key: "ROADMAP-456" },
            effort: 1.3, // Invalid effort
            labels: [], // Missing area and team labels
          },
        }),
      ];
      
      const issuesByRoadmapItems = {
        "ROADMAP-456": issues,
      };
      
      const result = generateOverview([issues], issuesByRoadmapItems, mockRoadmapItems, mockSprints, mockConfig);
      
      expect(result).toHaveLength(1);
      expect(result[0].sprints[0].releaseItems[0].validations).toHaveLength(4);
    });

    it("should handle complex sprint scheduling scenarios", () => {
      const currentDate = new Date("2024-01-15T12:00:00.000Z");
      const futureSprint = {
        id: 3,
        name: "Sprint 3",
        state: "future" as const,
        startDate: "2030-02-01T00:00:00.000Z",
        endDate: "2030-02-14T23:59:59.000Z",
        originBoardId: 123,
      };
      
      const issues = [
        createMockJiraIssue({
          key: "RELEASE-001",
          fields: {
            ...createMockJiraIssue().fields,
            parent: { key: "ROADMAP-456" },
            summary: "Feature (s2)",
            sprint: futureSprint,
          },
        }),
      ];
      
      const issuesByRoadmapItems = {
        "ROADMAP-456": issues,
      };
      
      const result = generateOverview([issues], issuesByRoadmapItems, mockRoadmapItems, [futureSprint], mockConfig);
      
      expect(result).toHaveLength(1);
      expect(result[0].validations.hasScheduledRelease).toBe(true);
    });
  });
});
*/
